{"mappings":"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","sources":["src/index.ts","src/events/outboundLink.ts","src/utils/tracker.ts","src/events/pageView.ts","src/events/searchBox.ts","src/utils/debounce.ts","src/utils/getPageData.ts","src/utils/logger.ts"],"sourcesContent":["import outboundLink from \"./events/outboundLink\";\nimport pageView from \"./events/pageView\";\nimport searchBox from \"./events/searchBox\";\nimport getPageData from \"./utils/getPageData\";\nimport { logError, logInfo } from \"./utils/logger\";\ndeclare global {\n  interface Window {\n    GTM_ID: string;\n    dataLayer: any[];\n  }\n}\n\n// Google Tag Manager\n(function (w, d, s, l, i) {\n  w[l] = w[l] || [];\n  w[l].push({ \"gtm.start\": new Date().getTime(), event: \"gtm.js\" });\n  var f = d.getElementsByTagName(s)[0],\n    j = d.createElement(s) as HTMLScriptElement,\n    dl = l != \"dataLayer\" ? \"&l=\" + l : \"\";\n  j.async = true;\n  j.src = \"https://www.googletagmanager.com/gtm.js?id=\" + i + dl;\n  j.onload = () => {\n    logInfo(\"GTM loaded\");\n    if (document.readyState === \"complete\") {\n      __init__();\n    } else {\n      window.addEventListener(\"load\", __init__);\n    }\n  };\n  f.parentNode.insertBefore(j, f);\n})(window, document, \"script\", \"dataLayer\", window.GTM_ID);\n// End Google Tag Manager\n\n// init function to be called when the page is loaded\nfunction __init__() {\n  const pageData = getPageData();\n\n  pageView(pageData);\n  searchBox(pageData);\n  outboundLink(pageData);\n}\n","import { BASE_DATA } from \"../utils/getPageData\";\nimport tracker from \"../utils/tracker\";\n\nexport default (data: BASE_DATA) => {\n  document.documentElement.addEventListener(\"click\", (e) => {\n    const el = e.target as HTMLAnchorElement;\n    const anchor = el.closest(\"a\");\n    if (!anchor) return;\n    if (anchor.closest(\"a\").origin !== location.origin) {\n      tracker({\n        ...data,\n        event: \"link_clicked\",\n      });\n    }\n  });\n};\n","export default (data) => {\n  console.log(data);\n  window.dataLayer.push(data);\n};\n","import { BASE_DATA } from \"../utils/getPageData\";\nimport tracker from \"../utils/tracker\";\n\nexport default (data: BASE_DATA) => {\n  tracker({\n    ...data,\n    event: \"page_viewed\",\n  });\n};\n","import { BASE_DATA } from \"../utils/getPageData\";\nimport tracker from \"../utils/tracker\";\n\nimport debounce from \"../utils/debounce\";\n\nexport default (data: BASE_DATA) => {\n  const searchBox = document.getElementById(\"query\") as HTMLInputElement;\n  const suggestions: HTMLElement = document.querySelector(\n    \"span.algolia-autocomplete\"\n  );\n\n  if (!searchBox || !suggestions) return;\n\n  const form = searchBox.closest(\"form\");\n\n  form.addEventListener(\"submit\", (e) => {\n    tracker({\n      ...data,\n      search_keyword: searchBox.value,\n      search_type: \"site_search\",\n      event: \"content_searched\",\n    });\n  });\n\n  // Options for the observer (which mutations to observe)\n  const config = { attributes: true, childList: false, subtree: false };\n\n  // let's not fire the event too often\n  const debouncedTeacker = debounce(tracker, 500);\n\n  // Callback function to execute when mutations are observed\n  const callback = function (mutationsList) {\n    for (const mutation of mutationsList) {\n      if (\n        mutation.type === \"attributes\" &&\n        mutation.attributeName === \"style\"\n      ) {\n        const showSuggestions = suggestions.style.display !== \"none\";\n\n        if (showSuggestions) {\n          debouncedTeacker({\n            ...data,\n            search_keyword: searchBox.value,\n            search_type: \"site_search\",\n            event: \"content_searched\",\n          });\n        }\n      }\n    }\n  };\n\n  // Create an observer instance linked to the callback function\n  const observer = new MutationObserver(callback);\n\n  // Start observing the target node for configured mutations\n  observer.observe(suggestions, config);\n\n  // // // Later, you can stop observing\n  // // observer.disconnect();\n};\n","const debounce = (callback, wait) => {\n  let timeoutId = null;\n  return (...args) => {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      callback.apply(null, args);\n    }, wait);\n  };\n};\n\nexport default debounce;\n","interface BASE_DATA {\n  crn?: string;\n  customer_id?: string;\n  page_language: string;\n  login_status: \"logged_in\" | \"guest\";\n}\n\nconst baseData: BASE_DATA = {\n  crn: null,\n  customer_id: null,\n  page_language: navigator.language.split(\"-\")[0],\n  login_status: \"guest\",\n};\nexport default (): BASE_DATA => {\n  const dataDiv: HTMLDivElement = document.querySelector(\"#__za_data__\");\n\n  const data = Array.from(dataDiv.children).reduce<Record<string, string>>(\n    (acc, el) => {\n      const element = el as HTMLElement;\n      const value = element.innerText;\n      if (value) {\n        acc[el.id] = value;\n      }\n      return acc;\n    },\n    {}\n  );\n  const { __user_name__, ...rest } = data;\n\n  return {\n    ...baseData,\n    login_status: __user_name__ ? \"logged_in\" : \"guest\",\n  };\n};\n\nexport type { BASE_DATA };\n","const error = \"color: #ff0909; font-size: 14px; font-weight:bold\";\nconst info = \"color: #00a0ff; font-size: 14px; font-weight:bold\";\n\nconst logError = (...msg) => console.warn(`%c${msg.join(\"\\n\")}`, error);\nconst logInfo = (...msg) => console.info(`%c${msg.join(\"\\n\")}`, info);\n\nexport { logError, logInfo };\n"],"names":[],"version":3,"file":"main.js.map","sourceRoot":"../"}