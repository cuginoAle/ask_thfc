{"mappings":"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","sources":["src/index.ts","src/events/newRequest.ts","src/utils/tracker.ts","src/events/pageView.ts","src/events/searchBox.ts","src/utils/debounce.ts","src/utils/getPageData.ts","src/utils/logger.ts"],"sourcesContent":["import newRequest from \"./events/newRequest\";\nimport outboundLink from \"./events/outboundLink\";\nimport pageView from \"./events/pageView\";\nimport searchBox from \"./events/searchBox\";\nimport getPageData from \"./utils/getPageData\";\nimport { logError, logInfo } from \"./utils/logger\";\ndeclare global {\n  interface Window {\n    GTM_ID: string;\n    dataLayer: any[];\n  }\n}\n\n// Google Tag Manager\n(function (w, d, s, l, i) {\n  w[l] = w[l] || [];\n  w[l].push({ \"gtm.start\": new Date().getTime(), event: \"gtm.js\" });\n  var f = d.getElementsByTagName(s)[0],\n    j = d.createElement(s) as HTMLScriptElement,\n    dl = l != \"dataLayer\" ? \"&l=\" + l : \"\";\n  j.async = true;\n  j.src = \"https://www.googletagmanager.com/gtm.js?id=\" + i + dl;\n  j.onload = () => {\n    logInfo(\"GTM loaded\");\n    if (document.readyState === \"complete\") {\n      __init__();\n    } else {\n      window.addEventListener(\"load\", __init__);\n    }\n  };\n  f.parentNode.insertBefore(j, f);\n})(window, document, \"script\", \"dataLayer\", window.GTM_ID);\n// End Google Tag Manager\n\n// init function to be called when the page is loaded\nfunction __init__() {\n  const pageData = getPageData();\n\n  pageView(pageData);\n  searchBox(pageData);\n  newRequest(pageData);\n\n  // This is not needed for now\n  // outboundLink(pageData);\n}\n","import { BASE_DATA } from \"../utils/getPageData\";\nimport tracker from \"../utils/tracker\";\n\nexport default (data: BASE_DATA) => {\n  const form = document.getElementById(\"new_request\") as HTMLFormElement;\n\n  if (!form) return;\n\n  const submitButton = form.querySelector(\n    \"input[type='submit']\"\n  ) as HTMLButtonElement;\n\n  if (submitButton) {\n    form.addEventListener(\"submit\", (e) => {\n      tracker({\n        ...data,\n        event: \"contact_enquired\",\n      });\n    });\n  }\n};\n","export default (data) => {\n  console.log(data);\n  window.dataLayer.push(data);\n};\n","import { BASE_DATA } from \"../utils/getPageData\";\nimport tracker from \"../utils/tracker\";\n\nexport default (data: BASE_DATA) => {\n  tracker({\n    ...data,\n    event: \"page_viewed\",\n  });\n};\n","import { BASE_DATA } from \"../utils/getPageData\";\nimport tracker from \"../utils/tracker\";\n\nimport debounce from \"../utils/debounce\";\n\nexport default (data: BASE_DATA) => {\n  const searchBox = document.getElementById(\"query\") as HTMLInputElement;\n\n  if (searchBox) {\n    const form = searchBox.closest(\"form\");\n\n    form.addEventListener(\"submit\", (e) => {\n      tracker({\n        ...data,\n        search_keyword: searchBox.value,\n        search_type: \"site_search\",\n        event: \"content_searched\",\n      });\n    });\n  }\n\n  const suggestions: HTMLElement = document.querySelector(\n    \"span.algolia-autocomplete\"\n  );\n\n  if (!suggestions) return;\n\n  // Options for the observer (which mutations to observe)\n  const config = { attributes: true, childList: false, subtree: false };\n\n  // let's not fire the event too often\n  const debouncedTeacker = debounce(tracker, 500);\n\n  // Callback function to execute when mutations are observed\n  const callback = function (mutationsList) {\n    for (const mutation of mutationsList) {\n      if (\n        mutation.type === \"attributes\" &&\n        mutation.attributeName === \"style\"\n      ) {\n        const showSuggestions = suggestions.style.display !== \"none\";\n\n        if (showSuggestions) {\n          debouncedTeacker({\n            ...data,\n            search_keyword: searchBox.value,\n            search_type: \"site_search\",\n            event: \"content_searched\",\n          });\n        }\n      }\n    }\n  };\n\n  // Create an observer instance linked to the callback function\n  const observer = new MutationObserver(callback);\n\n  // Start observing the target node for configured mutations\n  observer.observe(suggestions, config);\n\n  // // Later, you can stop observing\n  // observer.disconnect();\n};\n","const debounce = (callback, wait) => {\n  let timeoutId = null;\n  return (...args) => {\n    window.clearTimeout(timeoutId);\n    timeoutId = window.setTimeout(() => {\n      callback.apply(null, args);\n    }, wait);\n  };\n};\n\nexport default debounce;\n","interface BASE_DATA {\n  crn?: string;\n  customer_id?: string;\n  page_language: string;\n  login_status: \"logged_in\" | \"guest\";\n}\n\nconst baseData: BASE_DATA = {\n  crn: null,\n  customer_id: null,\n  page_language: document.documentElement.lang.split(\"-\")[0], // navigator.language.split(\"-\")[0],\n  login_status: \"guest\",\n};\nexport default (): BASE_DATA => {\n  const dataDiv: HTMLDivElement = document.querySelector(\"#__za_data__\");\n\n  const data = Array.from(dataDiv.children).reduce<Record<string, string>>(\n    (acc, el) => {\n      const element = el as HTMLElement;\n      const value = element.innerText;\n      if (value) {\n        acc[el.id] = value;\n      }\n      return acc;\n    },\n    {}\n  );\n  const { __user_name__, ...rest } = data;\n\n  return {\n    ...baseData,\n    login_status: __user_name__ ? \"logged_in\" : \"guest\",\n  };\n};\n\nexport type { BASE_DATA };\n","const error = \"color: #ff0909; font-size: 14px; font-weight:bold\";\nconst info = \"color: #00a0ff; font-size: 14px; font-weight:bold\";\n\nconst logError = (...msg) => console.warn(`%c${msg.join(\"\\n\")}`, error);\nconst logInfo = (...msg) => console.info(`%c${msg.join(\"\\n\")}`, info);\n\nexport { logError, logInfo };\n"],"names":[],"version":3,"file":"main.js.map"}